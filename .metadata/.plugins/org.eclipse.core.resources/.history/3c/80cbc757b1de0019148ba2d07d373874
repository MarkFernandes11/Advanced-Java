package com.bridgelabz.login;

import java.sql.ResultSet;
import java.sql.SQLException;

import org.apache.catalina.User;

import com.mysql.jdbc.Connection;
import com.mysql.jdbc.PreparedStatement;

public class UserDAOImplementation implements UserDAO 
{
	static Connection connection;
	PreparedStatement preparedSt;
	
	@Override
	public int insertUserIntoDatabase(Users user) 
	{
		int status = 0;
		try 
		{				
			connection = MyConnection.getConnection();
			preparedSt = (PreparedStatement) connection.prepareStatement("INSERT INTO Users(name,email,password) VALUES(?,?,?)");
			// (name,email,password)
			preparedSt.setString(1, user.getName());
			preparedSt.setString(2, user.getEmail());
			preparedSt.setString(3, user.getPassword());
			status = preparedSt.executeUpdate();
			System.out.println(status);
			connection.close();
		}
		catch (SQLException e) 
		{		
			e.printStackTrace();
		}
		return status;
	}

	@Override
	public Users getFromDatabase(String email, String pass) 
	{
		Users user = new Users();
		try 
		{
			connection = MyConnection.getConnection();
			preparedSt = (PreparedStatement) connection.prepareStatement("SELECT * FROM Users WHERE email=? AND password=?");
			preparedSt.setString(2, email);
			preparedSt.setString(3, pass);
			
			ResultSet resultSet = preparedSt.executeQuery();
			while(resultSet.next())
			{
				user.setName(resultSet.getString(1));
				user.setEmail(resultSet.getString(2));
				user.setPassword(resultSet.getString(2));
			}
		}
		catch (SQLException e) 
		{		
			e.printStackTrace();
		}
		return user;
	}		

}
