package com.bridgelabz.login;

import java.sql.ResultSet;
import java.sql.SQLException;

import org.apache.catalina.User;

import com.mysql.jdbc.Connection;
import com.mysql.jdbc.PreparedStatement;

public class UserDAOImplementation implements UserDAO 
{
	static Connection connection;
	PreparedStatement preparedSt;
	
	@Override
	public int insertUserIntoDatabase(Users user) 
	{
		int status = 0;
		try 
		{				
			connection = MyConnection.getConnection();
			preparedSt = (PreparedStatement) connection.prepareStatement("INSERT INTO Users(name,email,password) VALUES(?,?,?)");
			// (name,email,password)
			preparedSt.setString(1, user.getName());
			System.out.println(preparedSt);
			preparedSt.setString(2, user.getEmail());
			System.out.println(preparedSt);
			preparedSt.setString(3, user.getPassword());
			System.out.println(preparedSt);
			status = preparedSt.executeUpdate();
			System.out.println(status);
			connection.close();
		}
		catch (SQLException e) 
		{		
			e.printStackTrace();
		}
		finally{
			try {
				connection.close();
				preparedSt.close();
			} catch (SQLException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			}
			
		}
		return status;
	}

	@Override
	public Users getFromDatabase(String email, String pass) 
	{
		Users user = new Users();
		try 
		{
			connection = MyConnection.getConnection();
			preparedSt = (PreparedStatement) connection.prepareStatement("SELECT * FROM Users WHERE email=? AND password=?");
			preparedSt.setString(1, email);
			System.out.println(preparedSt);
			preparedSt.setString(2, pass);
			System.out.println(preparedSt);
			
			ResultSet resultSet = preparedSt.executeQuery();
			while(resultSet.next())
			{
				user.setName(resultSet.getString(1));
				System.out.println(user.getName());
				user.setEmail(resultSet.getString(2));
				System.out.println(user.getEmail());
				user.setPassword(resultSet.getString(3));
				System.out.println(user.getPassword());
			}
		}
		catch (SQLException e) 
		{		
			e.printStackTrace();
		}
		try {
			connection.close();
			preparedSt.close();
		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		return user;
	}
	
	public boolean checkUser(String username, String passwordCheck) throws SQLException
	{
		try 
		{
			connection = MyConnection.getConnection();
			preparedSt = (PreparedStatement) connection.prepareStatement("SELECT * FROM Users WHERE email=? AND password=?");
			System.out.println(preparedSt);
			preparedSt.setString(1, username);
			System.out.println(preparedSt);
			preparedSt.setString(2, passwordCheck);
			System.out.println(preparedSt);
			
			ResultSet result = preparedSt.executeQuery();
			System.out.println(result.next());
			if(result.next())
			{
				return true;
			}
			
		}
		catch (SQLException e) 
		{		
			e.printStackTrace();
		}
		finally{
			connection.close();
			preparedSt.close();
		}
		return false;
	}

}
